const { cmd } = require('../command');
const axios = require('axios');

cmd({
    pattern: "tt",
    alias: ["tiktok", "ttdl"],
    react: "ğŸµ",
    desc: "Download TikTok video without watermark",
    category: "download",
    use: ".tt <tiktok url>",
    filename: __filename
},
async (conn, mek, m, { from, q, reply }) => {
    try {
        if (!q || !q.includes("tiktok")) {
            return reply(`
*â•­×‚â”„â”€Ì‡â”€Ì£â”„â”€Ì‡â”€Ì£â”„â”€Ì‡â”€Ì£â”„â”€Ì‡â”€Ì£â”„â”€Ì‡â”€Ì£â”€Ì‡â”€Ì£â”€á›­*
*â”‚ â•Œâ”€Ì‡â”€Ì£âŠ° á—©á—ªá—´á—´á’ª-á™­á—°á—ª âŠ±â”ˆâ”€Ì‡â”€Ì£â•Œ*
*â”‚â”€Ì‡â”€Ì£â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”€Ì‡â”€Ì£*
*â”‚âŒ ğˆğ§ğ¯ğšğ¥ğ¢ğ ğ“ğ¢ğ¤ğ“ğ¨ğ¤ ğ‹ğ¢ğ§ğ¤*
*â”‚ğŸ“Œ Example:*
*â”‚ .tt https://vm.tiktok.com/xxxx*
*â•°â”„â”€Ì£â”„â”€Ì‡â”€Ì£â”„â”€Ì‡â”€Ì£â”„â”€Ì‡â”€Ì£â”„â”€Ì‡â”€Ì£â”€Ì‡â”€Ì£â”€á›­*

> á´˜á´á´¡á´‡Ê€á´‡á´… Ê™Ê á—©á—ªá—´á—´á’ª-á™­á—°á—ª
`);
        }

        await reply("â³ *á—©á—ªá—´á—´á’ª-á™­á—°á—ª is downloading TikTokâ€¦*");

        const apiUrl = `https://arslanmd-api.vercel.app/api/ttdl?url=${encodeURIComponent(q)}`;
        const { data } = await axios.get(apiUrl);

        if (!data.status || !data.result?.video) {
            return reply(`
*â•­×‚â”„â”€Ì‡â”€Ì£â”„â”€Ì‡â”€Ì£â”„â”€Ì‡â”€Ì£â”„â”€Ì‡â”€Ì£â”„â”€Ì‡â”€Ì£â”€Ì‡â”€Ì£â”€á›­*
*â”‚ â•Œâ”€Ì‡â”€Ì£âŠ° á—©á—ªá—´á—´á’ª-á™­á—°á—ª âŠ±â”ˆâ”€Ì‡â”€Ì£â•Œ*
*â”‚â”€Ì‡â”€Ì£â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”€Ì‡â”€Ì£*
*â”‚âŒ ğ“ğ¢ğ¤ğ“ğ¨ğ¤ ğƒğ¨ğ°ğ§ğ¥ğ¨ğšğ ğ…ğšğ¢ğ¥ğğ*
*â”‚ğŸ”’ Video may be private or expired*
*â•°â”„â”€Ì£â”„â”€Ì‡â”€Ì£â”„â”€Ì‡â”€Ì£â”„â”€Ì‡â”€Ì£â”„â”€Ì‡â”€Ì£â”€Ì‡â”€Ì£â”€á›­*

> á´˜á´á´¡á´‡Ê€á´‡á´… Ê™Ê á—©á—ªá—´á—´á’ª-á™­á—°á—ª
`);
        }

        const caption = `
*â•­×‚â”„â”€Ì‡â”€Ì£â”„â”€Ì‡â”€Ì£â”„â”€Ì‡â”€Ì£â”„â”€Ì‡â”€Ì£â”„â”€Ì‡â”€Ì£â”€Ì‡â”€Ì£â”€á›­*
*â”‚ â•Œâ”€Ì‡â”€Ì£âŠ° á—©á—ªá—´á—´á’ª-á™­á—°á—ª _â¸â·Â³ âŠ±â”ˆâ”€Ì‡â”€Ì£â•Œ*
*â”‚â”€Ì‡â”€Ì£â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”€Ì‡â”€Ì£*
*â”‚ğŸµ ğ“ğ¢ğ¤ğ“ğ¨ğ¤ ğƒğ¨ğ°ğ§ğ¥ğ¨ğšğğğ*
*â”‚ğŸ‘¤ ğ€ğ®ğ­ğ¡ğ¨ğ«:* ${data.result.author || "Unknown"}
*â”‚ğŸ’§ ğğ¨ ğ–ğšğ­ğğ«ğ¦ğšğ«ğ¤*
*â•°â”„â”€Ì£â”„â”€Ì‡â”€Ì£â”„â”€Ì‡â”€Ì£â”„â”€Ì‡â”€Ì£â”„â”€Ì‡â”€Ì£â”€Ì‡â”€Ì£â”€á›­*

> á´˜á´á´¡á´‡Ê€á´‡á´… Ê™Ê á—©á—ªá—´á—´á’ª-á™­á—°á—ª
`;

        await conn.sendMessage(from, {
            video: { url: data.result.video },
            mimetype: "video/mp4",
            caption,
            contextInfo: {
                mentionedJid: [m.sender],
                forwardingScore: 999,
                isForwarded: true,
                forwardedNewsletterMessageInfo: {
                    newsletterJid: '120363423571792427@newsletter',
                    newsletterName: 'á—©á—ªá—´á—´á’ª-á™­á—°á—ª',
                    serverMessageId: 143
                }
            }
        }, { quoted: mek });

    } catch (e) {
        console.error("TIKTOK ERROR:", e);

        reply(`
*â•­×‚â”„â”€Ì‡â”€Ì£â”„â”€Ì‡â”€Ì£â”„â”€Ì‡â”€Ì£â”„â”€Ì‡â”€Ì£â”„â”€Ì‡â”€Ì£â”€Ì‡â”€Ì£â”€á›­*
*â”‚ â•Œâ”€Ì‡â”€Ì£âŠ° á—©á—ªá—´á—´á’ª-á™­á—°á—ª  âŠ±â”ˆâ”€Ì‡â”€Ì£â•Œ*
*â”‚â”€Ì‡â”€Ì£â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”€Ì‡â”€Ì£*
*â”‚âŒ ğ“ğ¢ğ¤ğ“ğ¨ğ¤ ğ‚ğ¨ğ¦ğ¦ğšğ§ğ ğ„ğ«ğ«ğ¨ğ«*
*â”‚â³ Please try again later*
*â•°â”„â”€Ì£â”„â”€Ì‡â”€Ì£â”„â”€Ì‡â”€Ì£â”„â”€Ì‡â”€Ì£â”„â”€Ì‡â”€Ì£â”€Ì‡â”€Ì£â”€á›­*

> á´˜á´á´¡á´‡Ê€á´‡á´… Ê™Ê á—©á—ªá—´á—´á’ª-á™­á—°á—ª
`);
    }
});
